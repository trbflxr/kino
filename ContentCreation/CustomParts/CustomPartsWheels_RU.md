# Создание кастомных дисков

## Подготовка и создание пака

Если вы уже создали пак и хотите добавить в него новые диски, то этот шаг можно пропустить.

Не нужно создавать для каждого диска отдельный пак, группируйте их по типам, производителям и т.д.

Для создания пака воспользуйтесь [этим гайдом](CustomParts_RU.md).

## Создание модели диска

> [!NOTE]
> Если вы занимались созданием дисков для воркшопа, то этот шаг можно пропустить и перейти к [импорту в Unity](#импорт-моделей-в-unity)

В гайде будет показан пример для `Blender`, если вы используете другой софт для моделирования, то шаги там будут примерно такими же.

После того как вы создали модель диска его нужно подготовить к экспорту.

> [!IMPORTANT]
> Диск должен быть расположен лицевой стороной по направлению оси `X`.

> [!IMPORTANT]
> Диск должен состоять минимум из двух частей: `rim` и `spokes`, названия должны быть именно такими. А так же эти части не должны иметь текстур.

Однако у диска может быть более двух компонентов, и их уже можно называть как угодно. Также их можно текстурировать.

В примере ниже у диска есть компонент `wheel_nuts`.

> [!IMPORTANT]
> Так же обратите внимание на смещение диска относительно нулевых координат. Диск будет установлен на ступицу точкой центральной точкой части `spokes`. Имейте это ввиду и при необходимости диск можно подвинуть в том или ином направлении по оси `X`.

![parts_wheel_blender_info](../Images/CarParts/parts_wheel_blender_info.png)

Теперь диск нужно подогнать под игровые размеры. Для этого импортируйте на сцену модель для фитмента, которая находится в папке `kino_content_sdk/FitmentModels` и подгоните размеры вашего диска под размер примерочной модели.

![parts_wheel_blender_fit](../Images/CarParts/parts_wheel_blender_fit.png)

После чего диск можно экспортировать. Убедитесь, что параметры для секции `Transform` указаны такие же, как и на изображении.

Так же, если на сцене есть сторонние объекты, и вы не хотите что бы они попали в модель, вы можете выбрать одну из опций `Limit to`. Однако лишние компоненты можно будет уже в Unity после создания префаба.

![parts_blender_export](../Images/CarParts/parts_blender_export.png)

По завершению экспорта можно приступать к импорту модели в Unity.

## Импорт моделей в Unity

Для импорта моделей в Unity вы можете перетащить нужные файлы в окно `Project` или поместить их туда вручную, через проводник.

После импорта выберите нужную модель и в окне `Inspector` перейдите на вкладку `Materials`.

Если кнопки `Extract Textures` и `Extract Materials` серые и не кликабельные, то ничего делать не нужно.

Если же они активны, то сперва извлеките текстуры, а после материалы.

![parts_unity_import_model](../Images/CarParts/parts_unity_import_model.png)

## Добавление дисков в пак

> [!WARNING]
> Если на этом этапе вы всё ещё не создали метаданные для пака, то сделайте это по [инструкции выше](#подготовка-и-создание-пака).

Для того что бы диски стали доступны в игре их нужно добавить в пак. Сделать это очень просто.

1. В окне `Project` выберите ранее файл `__meta`

![parts_select_pack_meta](../Images/CarParts/parts_select_pack_meta.png)

2. После чего добавьте слот под диск в список нажав на `+`
3. Заполните поля, как на примере ниже

![parts_fill_part_meta](../Images/CarParts/parts_fill_part_meta.gif)

> [!NOTE]
> Обратите внимание, что в поле `Replacement Id` я указал значение `111`, так как именно этот диск **из стандартного набора** игры максимально похож на тот, который я добавил.

![parts_similar_part_id](../Images/CarParts/parts_similar_part_id.png)

### Replacement Id

Опциональное, но крайне желательное к заполнению поле. Нужно для того, что бы у людей, у которых нет **Kino** или **этого пака** на машину установилась максимально похожая стандартная деталь.

## Сборка пака

Заключительным этапом является сборка пака.

Процесс сборки описан для всех типов паков [тут](CustomParts_RU.md#сборка-паков).

---

## Проблемы с отображением в игре

Если после загрузки дисков в игру их не видно, или они повернуты неверно, то это очень просто исправить.

Сперва нужно создать префаб диска. Для этого нажмите правой кнопкой по модели диска в окне **Project**, затем выберите `Create -> Prefab Variant`.

![parts_create_prefab](../Images/CarParts/parts_create_prefab.png)

После чего в файле метаданных замените префаб диска на только что созданный.

![parts_meta_replace_prefab](../Images/CarParts/parts_meta_replace_prefab.png)

Перейдите в режим редактирования дважды кликнув по новому префабу в окне `Project`.

![parts_wheels_edit_prefab](../Images/CarParts/parts_wheels_edit_prefab.png)

### Проблемы с масштабом (не видно диск)

Убедитесь, что у корневого объекта (в данном случае `crooked_ssr`), у компонента `Transform`, в полях `Scale` установлено **1**.

После чего выделите все объекты внутри корневого и обратите внимание на параметр `Scale` у компонента `Transform`.

![parts_wheel_select_childs](../Images/CarParts/parts_wheel_select_childs.png)

Если выделали всё по гайду, то в поле масштаб у вас будет значение больше или равно единицы (1).
Однако если вы видите значения ниже единицы, то установите в поля `Scale` значение **1**, сохраните префаб, пересоберите пак и проверьте в игре.

Таким образом подберите правильный масштаб.

### Диск неправильно повёрнут

Перейдите в редактирование префаба, и обратите внимание в какую сторону направлен диск.
Правильное положение диска должно выглядеть так. Диск должен смотреть в обратном направлении по оси `X`, как это показано ниже.

![parts_wheel_correct_rotation](../Images/CarParts/parts_wheel_correct_rotation.png)

Если у вас диск расположен иначе, то выберите все объекты внутри корневого и поверните их правильно.

![parts_wheel_select_childs](../Images/CarParts/parts_wheel_select_childs.png)

В данном случае значение `-90` по оси `Y` исправили проблему.

![parts_wheel_correct_wheel_rotation_transform](../Images/CarParts/parts_wheel_correct_wheel_rotation_transform.png)

### Диск имеет неверное смещение

Если у диска в игре некорректный вылет или он смещён по какой-то оси, то это очень просто исправить.

![parts_wheel_bad_offset](../Images/CarParts/parts_wheel_bad_offset.png)

Выберите нужный префаб и даблкликом перейдите в режим редактирования. Затем выберите все объекты внутри корневого и обратите внимание на параметр `Position` у компонента `Transform`.

![parts_wheel_offset_info](../Images/CarParts/parts_wheel_offset_info.png)

Игра будет крепить диск к ступице (wheel hub) точкой, которая установлена в объекте `spokes`. На скрине выше видно, насколько эта точка выдвинута, от того в игре посадка у диска некорректная.

Подвиньте все объекты внутри корневого, что бы на расстояние нужное для компенсации смещения.

![parts_wheel_offset_fix](../Images/CarParts/parts_wheel_offset_fix.png)

В данном случае значение `0.071` по оси `X` исправило ситуацию.

После сохраните префаб и пересоберите пак.

### Диск по-прежнему смещен или застрял в тормозах

Если после того, как вы установили оффсеты для его частей, диск всё ещё смещен, то нужно исправить его модель в Blender.

На изображениях видно что *ориджин* у компонента `spokes` находится в центре самого объекта. Именно этой точкой колесо и будет прикреплено к ступице.

![parts_wheel_spokes_bad_offset](../Images/CarParts/parts_wheel_spokes_bad_offset.png)

![parts_wheel_spokes_bad_offset_unity](../Images/CarParts/parts_wheel_spokes_bad_offset_unity.png)

Для того что бы это исправить выполните следующие действия:

1. Откройте модель в Blender
2. Перейдите в `Object mode`
3. Установите 3D курсор в точку, где должен быть `ориджин`
4. Нажмите `Object -> Set Origin -> Origin to 3D Cursor`
5. После экспортируйте модель и [импортируйте](#импорт-моделей-в-unity) её в Unity

![parts_wheel_spokes_offset_fix](../Images/CarParts/parts_wheel_spokes_offset_fix.png)

### Диск имеет некорректное затенение, или он просто черный

Эта проблема связана с некорректной UV-разверткой диска и исправить её достаточно просто.

Решение предоставлено @Jeefrect (Discord: @jeefrect)

UV-развертка диска должна строго соответствовать примеру. Передняя сторона спиц и обода обязательно должны находиться в **правой половине** развертки.

![parts_wheel_uv_fix](../Images/CarParts/parts_wheel_uv_fix.gif)

* В **синей зоне** (for spokes) следует разместить UV-развертку спиц диска
* В **жёлтой зоне** (for rims) нужно разместить UV-развертку обода диска
* [Опционально] В **красной зоне** (for backface) нужно разместить задние стороны диска, если они у вас есть. В игре эти зоны будут иметь затемнение

![parts_wheel_uv_back](../Images/CarParts/parts_wheel_uv_back.png)

* **Зелёная зона** (for backface spoke), разместить UV-развертку задней стороны спиц
* **Синяя зона** (for backface spoke), разместить UV-развертку задней стороны обода диска

> [!NOTE]
> Чтобы быстро сделать UV-развертку развёртку выбранного объекта в Blender, необходимо нажать `U -> Unwrap`.

![parts_wheel_uv_unwrap](../Images/CarParts/parts_wheel_uv_unwrap.png)

Правильная UV-развертка должна выглядить так:

![parts_wheel_uv_both_sides](../Images/CarParts/parts_wheel_uv_both_sides.png)

Или же так, если вы делали её только для **передней части** диска:

![parts_wheel_uv_front](../Images/CarParts/parts_wheel_uv_front.png)
